#####################################################################
#      Includes
#####################################################################

[include macros.cfg]

[include Varia/*.cfg]
[include KlickyProbe/*.cfg]

#####################################################################
#     MCU - Printer Settings
#####################################################################

[mcu]
serial: /dev/serial/by-id/usb-Klipper_lpc1768_1EF00017C99C37AFCB0ABD5BC22000F5-if00
restart_method: command

#[mcu host]
#serial: /tmp/klipper_host_mcu

[printer]
kinematics: corexy
max_velocity: 300  
max_accel: 3000
max_accel_to_decel: 3000
max_z_velocity: 5
max_z_accel: 100	
square_corner_velocity: 5.0  

#####################################################################
# 	X/Y Stepper Settings
#####################################################################

[stepper_x]
##	Connected to X (B Motor)
step_pin: X_Step
dir_pin: !X_DIR
enable_pin: !X_EN
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 200
endstop_pin: X_MAX
position_min: 0
position_endstop: 396
position_max: 396
homing_speed: 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_x]
uart_pin: X_CS
interpolate: False
run_current: 0.8					#0.9
sense_resistor: 0.110
stealthchop_threshold: 0			#0

[stepper_y]
##	Connected to Y (A Motor)
step_pin: Y_Step
dir_pin: !Y_DIR
enable_pin: !Y_EN
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 200
endstop_pin: Y_MAX
position_min: 0
position_endstop: 377
position_max: 377
homing_speed: 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_y]
uart_pin: Y_CS
interpolate: False
run_current: 0.8					#0.9
sense_resistor: 0.110
stealthchop_threshold: 0
 
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Left Z Motor
## Z Stepper Socket
[stepper_z]
step_pin: Z_Step
dir_pin: !Z_DIR
enable_pin: !Z_EN
rotation_distance: 4			
microsteps: 32
full_steps_per_rotation: 200
endstop_pin: Z_MIN
position_max: 300
#position_endstop: 0.5
position_min: -15
homing_speed: 8.0
second_homing_speed: 3.0
homing_retract_dist: 3.0

[tmc2209 stepper_z]
uart_pin: Z_CS
interpolate: False
run_current: 0.6				#0.9
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Right Z Motor
##	E0 Stepper Socket
[stepper_z1]
step_pin: E0_Step
dir_pin: !E0_DIR
enable_pin: !E0_EN
rotation_distance: 4			
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z1]
uart_pin: E0_CS
interpolate: False
run_current: 0.6				#0.9
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
# 	Extruder
#####################################################################

#	Driver Socket E1
[extruder]
step_pin: E1_Step
dir_pin: E1_DIR
enable_pin: !E1_EN
rotation_distance: 20.009
gear_ratio: 50:10
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
max_extrude_cross_section: 500
heater_pin: HE_E0
sensor_type: ATC Semitec 104GT-2
sensor_pin: THERM1
min_temp: 10
max_temp: 270
max_power: 1.0
min_extrude_temp: 10
max_extrude_only_distance: 300
#control = pid
#pid_kp = 29.827
#pid_ki = 1.591
#pid_kd = 139.815

##	E1 on MCU
[tmc2209 extruder]
uart_pin: E1_CS
interpolate: false
run_current: 0.3
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - Z board, Servo Pin
heater_pin: HE_BED
sensor_type: EPCOS 100K B57560G104F
sensor_pin: THERM2
max_power: 1
min_temp: 0
max_temp: 120
#control = pid
#pid_kp = 67.879
#pid_ki = 0.931
#pid_kd = 1237.100

#####################################################################
#	Enclosure/MCU Temp Sensor Section
#####################################################################

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

#####################################################################
# 	Fan Control
#####################################################################

[heater_fan hotend_fan]
##	Hotend Fan - HE1 Connector
pin: HE_E1
max_power: 1.0
heater: extruder
heater_temp: 50.0
kick_start_time: 0.5

[fan]
##	Print Cooling Fan - Fan Pin
pin: FAN0
kick_start_time: 0.5
off_below: 0.10

[controller_fan controller_fan]
pin: Y_MIN
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0
heater: extruder, heater_bed
fan_speed: 1.0

#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[probe]
pin: X_MIN
x_offset: 0
y_offset: 21.00
z_offset: 6.42
speed: 5
samples: 3 
samples_result: median
sample_retract_dist: 3.0
samples_tolerance: 0.01
samples_tolerance_retries: 3

[bed_mesh]
speed: 200
horizontal_move_z: 10
mesh_min: 40,40
mesh_max: 337,330
fade_start: 0.6
fade_end: 10.0
probe_count: 5,5
algorithm: bicubic
relative_reference_index: 12

[z_tilt]
z_positions:
	-30, 185
	397, 185
points:
	30, 185
	347, 185
speed: 200
horizontal_move_z: 10
retries: 10
retry_tolerance: 0.0075

[screws_tilt_adjust]
screw1: 337,290
screw1_name: rear right screw
screw2: 40,290
screw2_name: rear left screw
screw3: 40,30
screw3_name: front left screw
screw4: 337,30
screw4_name: front right screw
horizontal_move_z: 10
speed: 200
screw_thread: CW-M4

#####################################################################
#	Resonance measuring
#####################################################################

#[adxl345]
#cs_pin: host:None

#[resonance_tester]
#accel_chip: adxl345
#probe_points:
#    188.5,185,60

[input_shaper]
shaper_freq_x: 53.4
shaper_type_x: mzv
shaper_freq_y: 41.6
shaper_type_y: mzv

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [stepper_z]
#*# position_endstop = 9.900
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 67.780
#*# pid_ki = 0.898
#*# pid_kd = 1278.493
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 29.410
#*# pid_ki = 2.108
#*# pid_kd = 102.568
